{% set title = "Analytics Settings"|t %}

{% if not craft.analytics.isInstalled %}

    {% redirect 'analytics/install' %}

{% else %}

    {% extends "_layouts/cp" %}
    {% import "_includes/forms" as forms %}

    {% set provider = 'Google' %}

    {% includeCssResource "analytics/css/styles.css" %}
    {% includeJsResource "analytics/js/checkUpdates.js" %}

    {% set crumbs = [
        { label: "Analytics"|t, url: url('analytics') },
    ] %}

    {% set provider = craft.oauth.getProvider('Google') %}
    {% set account = craft.oauth.getAccount(provider.handle, 'analytics.system') %}

    {% set content %}

        {% if not craft.analytics.isInstalled %}
            {% redirect 'analytics/settings' %}
        {% else %}

            {% set oauthUpdates = craft.analytics.pluginCheckUpdates('Oauth', 'oauth') %}
            {% set analyticsUpdates = craft.analytics.pluginCheckUpdates('Analytics', 'analytics') %}

            {% if oauthUpdates or analyticsUpdates %}
                <h2 class="first">Updates</h2>

                <p>There are updates available for the following plugins :</p>

                <ul>
                    {% if oauthUpdates %}
                    <li>OAuth</li>
                    {% endif %}

                    {% if analyticsUpdates %}
                    <li>Analytics</li>
                    {% endif %}
                </ul>

                <div class="buttons">
                    <a href="{{actionUrl('analytics/plugin/updateAllPlugins')}}" class="btn">Update Plugins</a>
                </div>

                <hr />

            {% endif %}


            <div class="dukt-update">
                <p class="center">There is an update available for the <strong class="plugin-name">[pluginClass]</strong> plugin. <a href="{{actionUrl('analytics/plugin/update')}}" class="btn submit small">Update now</a></p>
            </div>

            <form method="post" action="" accept-charset="UTF-8">
                <input type="hidden" name="action" value="analytics/settings/save" />
                <input type="hidden" name="redirect" value="analytics" />

                {{ forms.selectField({
                    first: true,
                    label: "Web Profile",
                    instructions: "Select an Analytics web profile to associate with your Craft website"|t,
                    options: craft.analytics.properties(),
                    name: 'profileId',
                    value: craft.analytics.getSetting('profileId')
                }) }}

                <p><input type="submit" value="Save" class="btn submit" /></p>
            </form>

            <hr />

            <p>
                Connected as {{account.email}}.

                <a class="btn small" href="{{craft.oauth.disconnect(provider.handle, 'analytics.system')}}">
                    Disconnect from {{provider.name}}
                </a>
            </p>
        {% endif %}

    {% endset %}
{% endif %}