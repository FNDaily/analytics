Analytics.Realtime=Garnish.Base.extend({init:function(s){this.$element=$("#"+s),this.$title=$(".title",this.$element),this.$body=$(".body",this.$element),this.$spinner=$(".spinner",this.$element),this.$streamstatus=$(".streamstatus",this.$element),this.$error=$(".error",this.$element),this.$activeVisitorsCount=$(".active-visitors .count",this.$realtimeVisitors),this.$progress=$(".progress",this.$realtimeVisitors),this.$legend=$(".legend",this.$realtimeVisitors),this.$realtimeVisitors=$(".analytics-realtime-visitors",this.$element),this.$newVisitorsProgress=$(".progress-bar.new-visitors",this.$realtimeVisitors),this.$newVisitorsValue=$(".progress-bar.new-visitors span",this.$realtimeVisitors),this.$returningVisitorsProgress=$(".progress-bar.returning-visitors",this.$realtimeVisitors),this.$returningVisitorsValue=$(".progress-bar.returning-visitors span",this.$realtimeVisitors),this.timer=!1,this.start(),setInterval($.proxy(function(){this.$streamstatus.hasClass("hidden")?this.$streamstatus.removeClass("hidden"):this.$streamstatus.addClass("hidden")},this),1e3)},start:function(){this.timer&&this.stop(),this.request(),this.timer=setInterval($.proxy(function(){this.request()},this),1e3*AnalyticsRealtimeInterval)},stop:function(){clearInterval(this.timer)},request:function(){this.$spinner.removeClass("body-loading"),this.$spinner.removeClass("hidden"),Craft.queueActionRequest("analytics/reports/getRealtimeReport",{},$.proxy(function(s,e){if("success"==e&&"undefined"==typeof s.error)this.$error.addClass("hidden"),this.$realtimeVisitors.removeClass("hidden"),this.handleResponse(s);else{var i="An unknown error occured.";"undefined"!=typeof s&&s&&"undefined"!=typeof s.error&&(i=s.error),this.$realtimeVisitors.addClass("hidden"),this.$error.html(i),this.$error.removeClass("hidden")}this.$spinner.addClass("hidden")},this))},handleResponse:function(s){var e=s.newVisitor,i=s.returningVisitor,t=1*i+1*e;if(this.$activeVisitorsCount.text(t),t>0?(this.$progress.removeClass("hidden"),this.$legend.removeClass("hidden")):(this.$progress.addClass("hidden"),this.$legend.addClass("hidden")),t>0)var r=Math.round(100*e/t);else var r=100;var n=100-r;this.$newVisitorsProgress.css("width",r+"%"),this.$newVisitorsValue.text(r+"%"),r>0?this.$newVisitorsProgress.removeClass("hidden"):this.$newVisitorsProgress.addClass("hidden"),this.$returningVisitorsProgress.css("width",n+"%"),this.$returningVisitorsValue.text(n+"%"),n>0?this.$returningVisitorsProgress.removeClass("hidden"):this.$returningVisitorsProgress.addClass("hidden")}});