google.load("visualization","1",{packages:["corechart","table","geochart"]});AnalyticsCountReport=Garnish.Base.extend({init:function(e){this.$element=$("#"+e);this.$inject=$(".analytics-inject",this.$element);this.$error=$(".analytics-error",this.$element);var t={start:this.$element.data("start"),end:this.$element.data("end")};this.$element.addClass("analytics-loading");Craft.queueActionRequest("analytics/getCountReport",t,$.proxy(function(e){if(typeof e.error!="undefined"){$(".inject",this.$error).html(e.error);this.$error.removeClass("hidden");$(this.$element).addClass("error")}else this.$inject.html(e.html);this.$element.removeClass("analytics-loading")},this))}});AnalyticsReport=Garnish.Base.extend({init:function(e){this.$element=$("#"+e);this.$errorElement=$(".error",this.$element);$id=this.$element.data("widget-id");this.$reportElements=$(".analyticsTab",this.$element);this.$charts=[];this.$chartData=[];console.log("element",this.$element);$(".analytics-tabs .analytics-nav a",this.$element).each($.proxy(function(e,t){$(t).click($.proxy(function(t,n){$(".analytics-nav a",this.$element).removeClass("active");$(t).addClass("active");$(".analyticsTab",this.$element).addClass("hidden");$($(".analyticsTab",this.$element).get(e)).removeClass("hidden");this.$element.trigger("redraw");return!1},this,t))},this));$(".analytics-tabs .analytics-nav li:first-child a",this.$element).trigger("click");$("a.more, a.less",this.$element).click($.proxy(function(e){var t=$(e.target).parents("div.more");if($("div.more-content",t).hasClass("hidden")){$("div.more-content",t).removeClass("hidden");$("a.more",t).addClass("hidden")}else{$("div.more-content",t).addClass("hidden");$("a.more",t).removeClass("hidden")}this.$element.trigger("redraw");return!1},this));Craft.queueActionRequest("analytics/report",{id:$id},$.proxy(function(e){if(typeof e.error!="undefined"){this.$errorElement.html(e.error);this.$element.addClass("analytics-error")}else{$reports=e.reports;$reportElements=this.$reportElements;$.each($reports,$.proxy(function(e,t){console.log("report",t);var n=$(".chart.piechart",$reportElements[e]).get(0),r=$(".chart.geochart",$reportElements[e]).get(0),i=$(".chart.areachart",$reportElements[e]).get(0),s=$(".chart.table",$reportElements[e]).get(0);this.$chartData[e]=new google.visualization.DataTable;var o=AnalyticsUtils.getColumns(t);$.each(o,$.proxy(function(t,n){this.$chartData[e].addColumn(n.type,n.name)},this));var u=AnalyticsUtils.getRows(t);this.$chartData[e].addRows(u);typeof this.$charts[e]=="undefined"&&(this.$charts[e]=[]);n?this.$charts[e].chart=AnalyticsUtils.getChart(n,"PieChart",t.options):r?this.$charts[e].chart=AnalyticsUtils.getChart(r,"GeoChart",t.options):i&&(this.$charts[e].chart=AnalyticsUtils.getChart(i,"AreaChart",t.options));s&&(this.$charts[e].table=AnalyticsUtils.getChart(s,"Table",t.options));typeof this.$charts[e]!="undefined"&&this.redraw();this.$element.bind("redraw",$.proxy(function(){this.redraw()},this));$(window).resize($.proxy(function(){},this))},this))}},this))},redraw:function(){var e=this.$reportElements.length;console.log("count elements",e,this.$chartData);for(i=0;i<e;i++)if(typeof this.$charts[i]!="undefined"){typeof this.$charts[i]["chart"]!="undefined"&&this.$charts[i].chart.chart.draw(this.$chartData[i],this.$charts[i].chart.chartOptions);typeof this.$charts[i]["table"]!="undefined"&&this.$charts[i].table.chart.draw(this.$chartData[i],this.$charts[i].table.chartOptions)}}});