google.load("visualization","1",{packages:["corechart","table","geochart"]});AnalyticsField=Garnish.Base.extend({init:function(e){console.log("fieldId",e);this.$field=$("#"+e);this.$metricElement=$(".analytics-metric select",this.$field);this.$chartElement=$(".chart",this.$field);this.$elementId=$(".analytics-field",this.$field).data("element-id");this.$chart=!1;$("#"+e+" .heading").addClass("hidden");var t=this;this.$metricElement.change(function(){t.$metric=$(this).val();t.request()});this.$metricElement.trigger("change")},request:function(){var chartData=new google.visualization.DataTable,options={};Craft.postActionRequest("analytics/elementReport",{id:this.$elementId,metric:this.$metric},function(response){$.each(response.apiResponse.columnHeaders,function(e,t){$type="string";if(t.name=="ga:date")$type="date";else if(t.dataType=="INTEGER"||t.dataType=="PERCENT"||t.dataType=="TIME")$type="number";console.log("header",$type,t.name);chartData.addColumn($type,t.name)});$.each(response.apiResponse.rows,function(k,row){$.each(response.apiResponse.columnHeaders,function(k2,columnHeader){if(columnHeader.name=="ga:date"){$date=response.apiResponse.rows[k][k2];$year=eval($date.substr(0,4));$month=eval($date.substr(4,2))-1;$day=eval($date.substr(6,2));newDate=new Date($year,$month,$day);response.apiResponse.rows[k][k2]=newDate}else columnHeader.dataType=="INTEGER"?response.apiResponse.rows[k][k2]=eval(response.apiResponse.rows[k][k2]):columnHeader.dataType=="PERCENT"?response.apiResponse.rows[k][k2]={f:Math.round(eval(response.apiResponse.rows[k][k2])*100)/100+" %",v:eval(response.apiResponse.rows[k][k2])}:columnHeader.dataType=="TIME"&&(response.apiResponse.rows[k][k2]={f:eval(response.apiResponse.rows[k][k2])+" seconds",v:eval(response.apiResponse.rows[k][k2])})})});console.log(response);chartData.addRows(response.apiResponse.rows);options={areaOpacity:.1,pointSize:8,lineWidth:4,legend:!1,hAxis:{baselineColor:"#fff",gridlines:{color:"none"}},series:{0:{targetAxisIndex:0},1:{targetAxisIndex:1}},vAxes:[{format:"#",textPosition:"in",baselineColor:"#ccc",gridlines:{color:"#eee"}},{format:"#",textPosition:"in",baselineColor:"#ccc",gridlines:{color:"#eee"}}],chartArea:{top:10,bottom:10,width:"100%",height:"80%"}};this.$chart=new google.visualization.AreaChart(this.$chartElement.get(0));typeof this.$chart!="undefined"&&this.$chart.draw(chartData,options);var $this=this;$(window).resize(function(){$this.$chart.draw(chartData,options)})},this)}});