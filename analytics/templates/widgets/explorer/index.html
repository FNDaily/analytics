{% import "_includes/forms" as forms %}

{% set webProperty = craft.analytics.webProperty %}

{% if webProperty %}
    {%- includeJsResource 'analytics/js/jsapi.js' first %}
    {% includeJsResource 'analytics/js/AnalyticsExplorer.js' %}
    {% includeCssResource "analytics/css/AnalyticsExplorer.css" %}
    {% includeJsResource 'analytics/js/AnalyticsUtils.js' %}

    <div class="analytics-widget analytics-small" data-widget-id="{{widget.id}}">

        {# actions #}

        <div class="analytics-actions">


            <div class="analytics-open"
                data-account-id="{{ webProperty.accountId }}"
                data-property-id="{{ webProperty.internalWebPropertyId }}"
                data-profile-id="{{ webProperty.defaultProfileId }}"></div>
            <div class="analytics-pin">
                <div class="analytics-pin-in"></div>
            </div>
        </div>

        <div class="analytics-collapsible">


            {# Menu #}

            <div class="analytics-menu">
                {{ forms.selectField({
                    options: browserSelect
                }) }}
            </div>


            {# Toolbar #}

            <div class="analytics-toolbar">

                {# Browser Settings #}

                <div class="analytics-settings">
                    <div class="analytics-settings-in">
                        <div class="analytics-settings-in-in">
                            <div class="analytics-fields left">

                                <div class="analytics-dimension-field analytics-field hidden">

                                    {{ forms.selectField({
                                        first: true,
                                        label: "Dimension"|t,
                                        class:"analytics-dimension small",
                                        name: 'dimension',
                                    }) }}

                                </div>

                                <div class="analytics-metric-field analytics-field">

                                    {{ forms.selectField({
                                        first: true,
                                        label: "Metric"|t,
                                        class:"analytics-metric small",
                                        name: 'metric',
                                    }) }}
                                </div>
                            </div>


                            <div class="right">

                                {# Chart type #}

                                <div class="field analytics-chart-picker">
                                    <div class="heading">
                                        <label>Chart</label>
                                    </div>
                                    <div class="input">
                                        <div class="analytics-tabletype btngroup">

                                            <div data-tabletype="area" role="button" class="btn active" title="{{ "Area"|t }}">
                                                <span class="icon-chart icon-chart-area"></span>
                                            </div>

                                            <div data-tabletype="counter" role="button" class="btn active" title="{{ "Counter"|t }}">
                                                <span class="icon-chart icon-chart-counter"></span>
                                            </div>

                                            <div data-tabletype="table" role="button" class="btn" title="{{ "Table"|t }}">
                                                <span class="icon-chart icon-chart-table"></span>
                                            </div>

                                            <div data-tabletype="pie" role="button" class="btn" title="{{ "Pie"|t }}">
                                                <span class="icon-chart icon-chart-pie"></span>
                                            </div>

                                            <div data-tabletype="geo" role="button" class="btn" title="{{ "Geo"|t }}">
                                                <span class="icon-chart icon-chart-geo"></span>
                                            </div>
                                        </div>

                                        <div class="analytics-disabled-tabletype btngroup">
                                        </div>

                                        &nbsp;
                                    </div>
                                </div>


                                {# Period #}

                                <div class="analytics-period">

                                    {{ forms.selectField({
                                        name: 'period',
                                        label: "Period"|t,
                                        options: [
                                            { "label": "Week"|t, "value": "week"},
                                            { "label": "Month"|t, "value": "month"},
                                            { "label": "Year"|t, "value": "year"},
                                        ]
                                    }) }}

                                </div>
                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>

        {# Realtime visitors #}

        <div class="analytics-realtime-visitors" data-view="realtimeVisitors">

            <div class="active-visitors">
                <span class="currently">{{'Currently'|t}}</span>
                <strong class="count">•••</strong>
                <span class="txt">{{'Active visitors on your website'|t}}</span>
            </div>

            <div class="progress hidden">
                <div class="progress-bar blue" style="width: 35%">
                    <span>35%</span>
                </div>
                <div class="progress-bar green" style="width: 65%">
                    <span>65%</span>
                </div>

                <div class="clear"></div>
            </div>

            <ul class="legend hidden">
                <li class="blue"><strong>50% </strong><span>{{'New'|t}}</span></li>
                <li class="green"><strong>50% </strong><span>{{'Returning'|t}}</span></li>
            </ul>

        </div>

        {# Browser #}

        <div class="analytics-browser" data-view="browser">

            {# Charts #}

            <div class="analytics-counter hidden">
                <div class="analytics-counter-value">•••</div>
                <div class="analytics-counter-label"></div>
                <div class="analytics-counter-period">last month</div>
            </div>

            <div class="analytics-area">
                <div class="analytics-infos">
                    <span class="analytics-infos-count">•••</span>
                    <span class="analytics-infos-metric">Visits</span>
                    <span class="analytics-infos-period">last month</span>
                </div>
                <div class="analytics-chart"></div>
            </div>

            <div class="analytics-geo">
                <div class="analytics-infos">
                    <span class="analytics-infos-dimension">Browsers</span>
                    <span class="analytics-infos-metric">Visits</span>
                    <span class="analytics-infos-period">last month</span>
                </div>
                <div class="analytics-chart"></div>
            </div>
            <div class="analytics-table hidden">
                <div class="analytics-infos">
                    <span class="analytics-infos-dimension">Browsers</span>
                    <span class="analytics-infos-metric">Visits</span>
                    <span class="analytics-infos-period">last month</span>
                </div>
                <div class="analytics-chart"></div>
            </div>
            <div class="analytics-pie hidden">
                <div class="analytics-infos">
                    <span class="analytics-infos-dimension">Browsers</span>
                    <span class="analytics-infos-metric">Visits</span>
                    <span class="analytics-infos-period">last month</span>
                </div>
                <div class="analytics-chart"></div>
            </div>

            {# Messages #}
            <div class="analytics-inject"></div>
            <div class="analytics-no-visitors hidden">No active visitors.</div>
        </div>

    </div>

    <div class="analytics-error error hidden">
        Error
    </div>
{% else %}
    <p>Analytics is not configured, please select a profile in <a href="{{ url('settings/plugins/analytics') }}">Analytics plugin settings</a>.</p>
{% endif %}