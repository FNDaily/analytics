Analytics.Realtime=Garnish.Base.extend({init:function(e){this.$element=$("#"+e),this.$title=$(".title",this.$element),this.$body=$(".body",this.$element),this.$spinner=$(".spinner",this.$element),this.$realtimeVisitors=$(".analytics-realtime-visitors",this.$element),this.timer=!1,this.startRealtime()},enable:function(){this.request(),this.startRealtime()},disable:function(){this.stopRealtime()},startRealtime:function(){this.timer&&this.stopRealtime(),this.timer=setInterval($.proxy(function(){this.request()},this),1e3*AnalyticsRealtimeInterval)},stopRealtime:function(){clearInterval(this.timer)},request:function(){this.$spinner.removeClass("body-loading"),this.$spinner.removeClass("hidden"),Craft.queueActionRequest("analytics/reports/getRealtimeReport",{},$.proxy(function(e,s){"success"==s&&"undefined"==typeof e.error?(this.$realtimeVisitors.removeClass("hidden"),this.handleResponse(e)):(msg="An unknown error occured.","undefined"!=typeof e&&e&&"undefined"!=typeof e.error&&(msg=e.error),this.$realtimeVisitors.addClass("hidden")),this.$spinner.addClass("hidden")},this))},handleResponse:function(e){var s=e.newVisitor,i=e.returningVisitor,t=1*i+1*s;if($(".active-visitors .count",this.$realtimeVisitors).text(t),t>0?($(".progress",this.$realtimeVisitors).removeClass("hidden"),$(".legend",this.$realtimeVisitors).removeClass("hidden")):($(".progress",this.$realtimeVisitors).addClass("hidden"),$(".legend",this.$realtimeVisitors).addClass("hidden")),t>0)var r=Math.round(100*s/t);else var r=100;var n=100-r;$(".progress-bar.blue",this.$realtimeVisitors).css("width",r+"%"),$(".progress-bar.blue span",this.$realtimeVisitors).text(r+"%"),r>0?$(".progress-bar.blue",this.$realtimeVisitors).removeClass("hidden"):$(".progress-bar.blue",this.$realtimeVisitors).addClass("hidden"),$(".progress-bar.green",this.$realtimeVisitors).css("width",n+"%"),$(".progress-bar.green span",this.$realtimeVisitors).text(n+"%"),n>0?$(".progress-bar.green",this.$realtimeVisitors).removeClass("hidden"):$(".progress-bar.green",this.$realtimeVisitors).addClass("hidden")}});