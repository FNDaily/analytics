{% extends "demos/analytics/charts/_layout" %}

{% set response = craft.analytics.api({
    startDate: date("-1 month")|date("Y-m-d"),
    endDate: 'today',
    metrics: 'ga:users',
    optParams:{
        dimensions: 'ga:latitude,ga:longitude,ga:city'
    }
}).send() %}

{% set jsonResponse = response|json_encode %}

{% block main %}

    <h1>Geo Cities</h1>

    <script type="text/javascript">

    google.load("visualization", "1", {packages:["corechart", "table", "geochart"]});

    google.setOnLoadCallback(drawChart);

    function drawChart() {

        var response = {{ response|json_encode|raw }};
        var data = AnalyticsUtils.responseToDataTable(response);
        var options = AnalyticsChartOptions.geo();
        var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));

        chart.draw(data, options);
    }
    </script>


    <div id="chart_div" style="width: 100%; height: 500px;"></div>

    <pre>{{ dump(response) }}</pre>

{% endblock main %}