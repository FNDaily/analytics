{% extends "_layouts/cp" %}

{% import "_includes/forms" as forms %}

{% set crumbs = [
	{ label: "Settings"|t('analytics'), url: url('settings') },
	{ label: "Plugins"|t('analytics'), url: url('settings/plugins') },
	{ label: "Analytics"|t('analytics'), url: url('analytics/settings') },
	{ label: "Sites"|t('analytics'), url: url('analytics/settings/sites') }
] %}

{% set title = site.name %}

{% set content %}

	<form method="post" accept-charset="UTF-8" data-saveshortcut>

		{{ csrfInput() }}

		<input type="hidden" name="action" value="analytics/settings/save-settings">
		<input type="hidden" name="pluginClass" value="Analytics">
		<input type="hidden" name="redirect" value="{{ 'analytics/settings'|hash }}">

		<div id="account-explorer" class="account-explorer">

			<h2 class="first">{{ "Google Analytics View (Profile)"|t('analytics') }}</h2>

			{{ forms.selectField({
				label: "Account"|t('analytics'),
				name: 'settings[accountId]',
				class: 'account',
				options: accountOptions,
				value: accountId,
			}) }}

			{{ forms.selectField({
				label: "Property"|t('analytics'),
				name: 'settings[webPropertyId]',
				class: 'property',
				options: webPropertyOptions,
				value: webPropertyId,
			}) }}

			{{ forms.selectField({
				label: "View"|t('analytics'),
				name: 'settings[profileId]',
				class: 'view',
				options: viewOptions,
				value: viewId,
			}) }}

			<div class="buttons">
				<div class="btn small refresh-views">Refresh</div> <div class="spinner hidden"></div>
			</div>
		</div>

		{% js %}

		{% if accountExplorerData %}
			var forceRefresh = false;
		{% else %}
			var forceRefresh = true;
		{% endif %}

		var accountExplorer = new Analytics.AccountExplorer('#account-explorer', { forceRefresh: forceRefresh, data: {{ accountExplorerData|json_encode|raw }}  });

		{% endjs %}

		<hr />

		<h2>{{ 'Realtime'|t('analytics') }}</h2>

		{{ forms.checkboxField({
			label: "Enable real-time"|t('analytics'),
			name: 'settings[enableRealtime]',
			checked: (settings.enableRealtime ? settings.enableRealtime : false),
			toggle: 'enableRealtime'
		}) }}

		<div id="enableRealtime"{% if not settings.enableRealtime %} class="hidden"{% endif %}>

			{{ forms.textField({
				label: "Real-Time Refresh Interval"|t('analytics'),
				instructions: "Interval in seconds between requests to real-time API."|t('analytics'),
				name: 'settings[realtimeRefreshInterval]',
				value: (settings.realtimeRefreshInterval ? settings.realtimeRefreshInterval : ''),
				errors: settings.getErrors('realtimeRefreshInterval'),
				size: 4
			}) }}
		</div>

		<div class="buttons">
			<input type="submit" class="btn submit force" value="{{ 'Save'|t('analytics') }}">
		</div>
	</form>

{% endset %}
